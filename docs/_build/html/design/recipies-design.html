

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Turbinia Recipes Design &mdash; Turbinia  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Design documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Turbinia
          

          
            
            <img src="../_static/turbinia-logo.jpg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer documentation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Design documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Turbinia Recipes Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#objective">Objective</a></li>
<li class="toctree-l3"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirements-and-scale">Requirements and Scale</a></li>
<li class="toctree-l3"><a class="reference internal" href="#design-ideas">Design Ideas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-task-configuration">Dynamic Task Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recipes">Recipes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alternatives-considered">Alternatives Considered</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Turbinia</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Design documentation</a> &raquo;</li>
        
      <li>Turbinia Recipes Design</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/design/recipies-design.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="turbinia-recipes-design">
<h1>Turbinia Recipes Design<a class="headerlink" href="#turbinia-recipes-design" title="Permalink to this headline">¶</a></h1>
<div class="section" id="objective">
<h2>Objective<a class="headerlink" href="#objective" title="Permalink to this headline">¶</a></h2>
<p>We want to be able to provide runtime configuration options to Turbinia that
configure how and which Tasks are run. We also want to be able to collect these
options in recipes that can be referred to and run by name.</p>
</div>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Currently Turbinia runs with a mostly static configuration, and so we run the
same set of Tasks and the same set of arguments for those Tasks. We would like
to be able to change the behavior of a given Turbinia run by passing this kind
of data in as a recipe. This would allow us to specify more targeted processing
and analysis for various scenarios.</p>
<p>The default Turbinia processing run can take a long time because it will run
every single Task and the default Task configurations will also process
everything. This means it can take some time before we get useful results back.
A recipe for “Quick Triage” would be handy to limit the Turbinia Tasks and to
specify a more targeted set of Forensic Artifacts and parsers for Plaso in order
to provide a quick response. This could be executed in parallel with the longer
running Turbinia run with the full configuration.</p>
</div>
<div class="section" id="requirements-and-scale">
<h2>Requirements and Scale<a class="headerlink" href="#requirements-and-scale" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Tasks should have a defined interface for possible configuration options
along with their defaults</p></li>
<li><p>Recipes should be defined in code and checked in</p></li>
<li><p>Turbinia clients (e.g. dfTimewolf) can pass in recipes at run time</p></li>
<li><p>The recipe should be specifiable by name at run time</p></li>
</ul>
</div>
<div class="section" id="design-ideas">
<h2>Design Ideas<a class="headerlink" href="#design-ideas" title="Permalink to this headline">¶</a></h2>
<p>There are two components of this to make it work. Dynamic Task configuration and
Recipes.</p>
</div>
<div class="section" id="dynamic-task-configuration">
<h2>Dynamic Task Configuration<a class="headerlink" href="#dynamic-task-configuration" title="Permalink to this headline">¶</a></h2>
<p>Tasks will define the configuration options that it can use at run time. This is
just a flat dict of options set in the Task object code. Only the options found
there can be configured dynamically by users. The values set in config will be
the defaults that are used by the Task when no overriding config is specified.</p>
<p>Here is an example of what PlasoTask.config could look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s1">&#39;artifacts_list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;MyDefaultArtifactName&#39;</span><span class="p">]</span>
 <span class="s1">&#39;parsers_list&#39;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These options can also be used to dynamically generate command line option flags
so users can specify those when making Turbinia requests.</p>
</div>
<div class="section" id="recipes">
<h2>Recipes<a class="headerlink" href="#recipes" title="Permalink to this headline">¶</a></h2>
<p>Recipes are a collection of these dynamic config options and some other global
config options. They are implemented as a dict with the global options (e.g.
<code class="docutils literal notranslate"><span class="pre">jobs_whitelist</span></code>) and a mapping of Task names to dicts of configuration options
we want to specify for those Tasks. These configuration options must correspond
to options that the Task itself exports in the TurbiniaTask.config attribute.</p>
<p>These recipes will be in a file per recipe, with the filename prefix being the
name of the recipe. All recipes are loaded by Turbinia when it starts. Users of
the CLI can specify a recipe to run by name, and Turbinia will pass in these
options to the tasks as they are run.</p>
<p>Because all of the options that can be specified by a recipe can also be
specified by CLI (<code class="docutils literal notranslate"><span class="pre">turbiniactl</span></code>) options, we don’t need to allow the user to
(directly) specify arbitrary recipe data structures. We can potentially allow
them to provide a recipe file that can be read and passed in as the recipe for
the given request. Another possibility could be for the command line flags to
override the options configured in a given recipe.</p>
<p>Here is an example of what a recipe could look like. This would exist in a file
similar to <code class="docutils literal notranslate"><span class="pre">quick-triage.recipe.json</span></code>. This is just one example, but we could
also implement this with YAML files, which might be a little easier to read and
configure.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;task_config&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;plaso&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;artifacts_list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;art1&#39;</span><span class="p">,</span> <span class="s1">&#39;art2&#39;</span><span class="p">],</span>
                           <span class="s1">&#39;parsers_list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]},</span>
                 <span class="s1">&#39;strings&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
 <span class="s1">&#39;patterns_list&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;my-keyword1&#39;</span><span class="p">,</span> <span class="s1">&#39;my-keyword2&#39;</span><span class="p">],</span>
 <span class="s1">&#39;jobs_whitelist&#39;</span><span class="p">:</span> <span class="p">[],</span>
 <span class="s1">&#39;jobs_blacklist&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;MyCrazyLongRunningJob&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Having no configuration options for some Tasks does not mean that the other
Jobs/Tasks will not be run. The global <code class="docutils literal notranslate"><span class="pre">jobs_whitelist</span></code> and <code class="docutils literal notranslate"><span class="pre">jobs_blacklist</span></code>
options (only one can be specified at a time) will be used to control which Jobs
are run.</p>
<p>Alternate clients (e.g. dfTimewolf) can pass in a recipe dictionary in the
TurbiniaRequest object that is created. Any options that are not listed in the
config exported by the task will be ignored and not passed into the Task.</p>
</div>
<div class="section" id="alternatives-considered">
<h2>Alternatives Considered<a class="headerlink" href="#alternatives-considered" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Passing around arbitrary dict objects that Tasks can read configuration data
from. This could cause maintenance and other issues without a defined
interface between the Tasks and the configuration.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Design documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Turbinia contributors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>